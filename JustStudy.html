<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Study Mode — Pognleap Peung</title>
  <style>
    :root{--bg:#f3f4f6;--card:#ffffff;--accent:#10b981;--muted:#6b7280;--green-1:#ebedf0;--green-2:#c6e48b;--green-3:#7bc96f;--green-4:#239a3b;--green-5:#1a742f;}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{background:var(--bg);display:flex;align-items:flex-start;justify-content:center;padding:24px}
    .app{width:980px;max-width:100%;pointer-events:auto;}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
    .title{font-weight:700;font-size:18px}
    .subtitle{color:var(--muted);font-size:13px}
    .btn{background:var(--accent);color:white;padding:8px 12px;border-radius:10px;border:0;cursor:pointer;transition:background-color .2s}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(16,185,129,.12);transition:background-color .2s,color .2s}
    .btn:hover{background:#0e9f6e;}
    .btn.ghost:hover{background:rgba(16,185,129,.1);color:#0e9f6e;}
    .layout{display:grid;grid-template-columns:1fr 360px;gap:16px}
    .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(2,6,23,.06);pointer-events:auto}
    .controls{display:flex;gap:8px;align-items:center;margin-bottom:12px}
    .timer{font-size:48px;font-weight:700;text-align:center;padding:18px;border-radius:12px}
    .status{font-size:13px;color:var(--muted);text-align:center;margin-top:8px}
    .checklist{margin-top:12px}
    .checklist input[type=text]{width:100%;padding:8px;border-radius:8px;border:1px solid #e5e7eb}
    .tasks{margin-top:10px;display:flex;flex-direction:column;gap:8px}
    .task{display:flex;align-items:center;gap:8px}
    .task label{flex:1; word-break: break-all;}
    .task input[type="checkbox"] {cursor:pointer;}
    .task.completed label {text-decoration: line-through; color: var(--muted);}
    textarea{width:100%;min-height:120px;padding:10px;border-radius:8px;border:1px solid #e5e7eb}
    .perf-grid{display:flex;flex-direction:column;gap:12px}
    .grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .day{width:36px;height:24px;border-radius:4px;background:#eee;display:flex;align-items:center;justify-content:center;font-size:10px;color:#111}
    .legend{display:flex;gap:6px;align-items:center}
    .small{font-size:12px;color:var(--muted)}
    footer{margin-top:14px;display:flex;justify-content:space-between;align-items:center}
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(2,6,23,.45);visibility:hidden;opacity:0;transition:all .18s;pointer-events:auto}
    .modal.show{visibility:visible;opacity:1}
    .modal .card{width:420px;pointer-events:auto}
    .modal-content {max-height: 80vh; overflow-y: auto;}
    .session-log-item {padding: 10px; border-bottom: 1px solid #e5e7eb;}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <div class="title">Study Mode — <span style="color:#0f172a">Pognleap Peung</span></div>
        <div class="subtitle">ID: 220702403584</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button id="helpBtn" class="btn ghost">Need Help?</button>
        <button id="viewPerf" class="btn">View Performance</button>
      </div>
    </header>

    <div class="layout">
      <div>
        <div class="card">
          <div class="controls">
            <label style="display:flex;gap:6px;align-items:center">
              <span class="small">Session (minutes)</span>
              <select id="sessionLen">
                <option value="25">25</option>
                <option value="45">45</option>
                <option value="50">50</option>
                <option value="15">15</option>
              </select>
            </label>

            <label style="display:flex;gap:6px;align-items:center">
              <span class="small">Auto break at (minutes)</span>
              <input id="autoBreakAt" type="number" value="15" style="width:64px;padding:6px;border-radius:6px;border:1px solid #e5e7eb" />
            </label>

            <div style="margin-left:auto;display:flex;gap:8px">
              <button id="startBtn" class="btn">Start Studying</button>
              <button id="pauseBtn" class="btn ghost">Pause</button>
              <button id="resetBtn" class="btn ghost">Reset</button>
            </div>
          </div>

          <div id="stage" style="margin-top:10px">
            <div id="timerBox" class="timer" style="background:linear-gradient(180deg,#fff,#fbfff8)">25:00</div>
            <div id="statusText" class="status">Idle</div>

            <div class="checklist">
              <div style="display:flex;gap:8px;align-items:center">
                <input id="newTask" type="text" placeholder="Add checklist item..." />
                <button id="addTask" class="btn ghost">Add</button>
              </div>

              <div id="tasks" class="tasks"></div>
            </div>

            <div style="margin-top:12px">
              <div style="font-weight:600;margin-bottom:6px">Study Notes / Summary</div>
              <textarea id="notes" placeholder="Write a short summary while you study..."></textarea>
              <div style="display:flex;justify-content:space-between;margin-top:8px;align-items:center">
                <div class="small">Notes are saved with each completed session.</div>
                <div style="display:flex;gap:8px">
                  <button id="saveNow" class="btn ghost">Save Notes</button>
                  <button id="endSession" class="btn">End Session</button>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>

      <div>
        <div class="card perf-grid">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div style="font-weight:700">Performance</div>
              <div class="small">Sessions & streaks</div>
            </div>
            <div style="text-align:right">
              <div id="totSessions" style="font-weight:700">0</div>
              <div class="small">Total sessions</div>
            </div>
          </div>

          <div>
            <div class="small" style="margin-bottom:6px">Last 30 days</div>
            <div id="grid" class="grid"></div>
            <div class="legend"><div class="small">Less</div>
              <div class="day" style="background:#c6e48b"></div>
              <div class="day" style="background:#7bc96f"></div>
              <div class="day" style="background:#239a3b"></div>
              <div class="day" style="background:#196127"></div>
              <div class="small">More</div>
            </div>
          </div>

          <hr />
          <div>
            <div style="font-weight:600;margin-bottom:6px">Recent sessions</div>
            <div id="recent"></div>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <div class="small">Study Mode — Simple utility · Designed for assignment</div>
      <div class="small">Made by Pognleap Peung · ID: 220702403584</div>
    </footer>
  </div>

  <div id="modal" class="modal">
    <div class="card modal-content">
      <h3 id="modalTitle">Break time</h3>
      <div id="modalBody" style="margin-top:8px;color:var(--muted)"></div>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
        <button id="modalClose" class="btn ghost">Close</button>
        <button id="modalAction" class="btn">OK</button>
      </div>
    </div>
  </div>

  <script>
    let timerInterval, secondsLeft, isRunning = false, isStudySession = true, startTime;
    const timerBox = document.getElementById('timerBox');
    const statusText = document.getElementById('statusText');
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const resetBtn = document.getElementById('resetBtn');
    const sessionLenSelect = document.getElementById('sessionLen');
    const autoBreakAtInput = document.getElementById('autoBreakAt');
    const notesTextarea = document.getElementById('notes');
    const saveNowBtn = document.getElementById('saveNow');
    const endSessionBtn = document.getElementById('endSession');
    const newTaskInput = document.getElementById('newTask');
    const addTaskBtn = document.getElementById('addTask');
    const tasksDiv = document.getElementById('tasks');
    const viewPerfBtn = document.getElementById('viewPerf');
    const totSessionsDiv = document.getElementById('totSessions');
    const gridDiv = document.getElementById('grid');
    const recentDiv = document.getElementById('recent');
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');
    const modalCloseBtn = document.getElementById('modalClose');
    const modalActionBtn = document.getElementById('modalAction');

    let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
    let sessions = JSON.parse(localStorage.getItem('sessions')) || [];

    function formatTime(s) {
      const m = Math.floor(s / 60);
      const sec = s % 60;
      return `${String(m).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
    }

    function renderTimer() {
      timerBox.textContent = formatTime(secondsLeft);
    }

    function tick() {
      if (secondsLeft > 0) {
        secondsLeft--;
        renderTimer();
        const elapsedMinutes = Math.floor((parseInt(sessionLenSelect.value) * 60 - secondsLeft) / 60);
        const autoBreakTime = parseInt(autoBreakAtInput.value);
        
        if (elapsedMinutes === autoBreakTime && autoBreakTime > 0) {
          showModal('Time for a short break!', `You have studied for ${autoBreakTime} minutes. It's a good time to take a break.`);
        }
      } else {
        clearInterval(timerInterval);
        isRunning = false;
        statusText.textContent = 'Finished';
        saveSession();
      }
    }

    function startTimer() {
      if (!isRunning) {
        isRunning = true;
        startTime = new Date();
        statusText.textContent = 'Studying';
        timerInterval = setInterval(tick, 1000);
      }
    }

    function pauseTimer() {
      if (isRunning) {
        isRunning = false;
        clearInterval(timerInterval);
        statusText.textContent = 'Paused';
      }
    }

    function resetTimer() {
      pauseTimer();
      secondsLeft = parseInt(sessionLenSelect.value) * 60;
      renderTimer();
      statusText.textContent = 'Idle';
    }

    function showModal(title, body, actionText = 'OK', actionCallback) {
      modalTitle.textContent = title;
      modalBody.textContent = body;
      modalActionBtn.textContent = actionText;
      modalActionBtn.onclick = function() {
        closeModal();
        if (actionCallback) actionCallback();
      };
      modal.classList.add('show');
    }

    function closeModal() {
      modal.classList.remove('show');
    }
    
    function addTask() {
        const text = newTaskInput.value.trim();
        if (text) {
            tasks.push({ text: text, completed: false });
            localStorage.setItem('tasks', JSON.stringify(tasks));
            newTaskInput.value = '';
            renderTasks();
        }
    }

    function renderTasks() {
        tasksDiv.innerHTML = '';
        tasks.forEach((task, index) => {
            const taskEl = document.createElement('div');
            taskEl.className = `task ${task.completed ? 'completed' : ''}`;
            taskEl.innerHTML = `
                <input type="checkbox" id="task-${index}" ${task.completed ? 'checked' : ''} onchange="toggleTask(${index})">
                <label for="task-${index}">${task.text}</label>
            `;
            tasksDiv.appendChild(taskEl);
        });
    }

    function toggleTask(index) {
        tasks[index].completed = !tasks[index].completed;
        localStorage.setItem('tasks', JSON.stringify(tasks));
        renderTasks();
    }
    
    function saveSession(isManualEnd = false) {
      const endTime = new Date();
      const duration = isManualEnd ? Math.floor((endTime - startTime) / 1000 / 60) : parseInt(sessionLenSelect.value);
      
      const sessionData = {
        date: endTime.toISOString().split('T')[0],
        duration: duration,
        tasks: tasks,
        notes: notesTextarea.value
      };
      
      sessions.push(sessionData);
      localStorage.setItem('sessions', JSON.stringify(sessions));
      
      notesTextarea.value = '';
      tasks = [];
      localStorage.setItem('tasks', JSON.stringify(tasks));
      renderTasks();
      updatePerformance();
      showModal('Session Saved!', `Your ${duration}-minute session and notes have been saved.`);
    }

    function updatePerformance() {
        totSessionsDiv.textContent = sessions.length;
        renderPerformanceGrid();
        renderRecentSessions();
    }

    function renderPerformanceGrid() {
        gridDiv.innerHTML = '';
        const today = new Date();
        const sessionsByDay = sessions.reduce((acc, session) => {
            acc[session.date] = (acc[session.date] || 0) + 1;
            return acc;
        }, {});

        for (let i = 29; i >= 0; i--) {
            const date = new Date();
            date.setDate(today.getDate() - i);
            const dateStr = date.toISOString().split('T')[0];
            const sessionsCount = sessionsByDay[dateStr] || 0;
            
            const dayDiv = document.createElement('div');
            dayDiv.className = 'day';
            dayDiv.textContent = sessionsCount;
            
            if (sessionsCount > 0 && sessionsCount <= 2) dayDiv.style.background = '#c6e48b';
            else if (sessionsCount > 2 && sessionsCount <= 5) dayDiv.style.background = '#7bc96f';
            else if (sessionsCount > 5 && sessionsCount <= 9) dayDiv.style.background = '#239a3b';
            else if (sessionsCount > 9) dayDiv.style.background = '#196127';
            
            gridDiv.appendChild(dayDiv);
        }
    }

    function renderRecentSessions() {
        recentDiv.innerHTML = '';
        const recent = sessions.slice(-5).reverse();
        
        if (recent.length === 0) {
            recentDiv.innerHTML = '<div class="small">No recent sessions found.</div>';
            return;
        }

        recent.forEach(session => {
            const sessionDiv = document.createElement('div');
            sessionDiv.className = 'small';
            sessionDiv.style.marginBottom = '4px';
            sessionDiv.innerHTML = `
                <strong>${session.date}:</strong> ${session.duration} min
                (${session.tasks.filter(t => t.completed).length}/${session.tasks.length} tasks)
            `;
            recentDiv.appendChild(sessionDiv);
        });
    }

    // Event listeners
    startBtn.onclick = startTimer;
    pauseBtn.onclick = pauseTimer;
    resetBtn.onclick = resetTimer;
    addTaskBtn.onclick = addTask;
    newTaskInput.onkeydown = (e) => { if (e.key === 'Enter') { addTask(); }};
    saveNowBtn.onclick = () => saveSession(true);
    endSessionBtn.onclick = () => {
      pauseTimer();
      saveSession(true);
      resetTimer();
    };
    viewPerfBtn.onclick = updatePerformance;
    modalCloseBtn.onclick = closeModal;

    sessionLenSelect.onchange = function() {
      if (!isRunning) {
        secondsLeft = parseInt(this.value) * 60;
        renderTimer();
      }
    };

    // Initial setup
    resetTimer();
    renderTasks();
    updatePerformance();
  </script>
</body>
</html>
